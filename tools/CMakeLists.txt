cmake_minimum_required(VERSION 3.10)

project(dele_launcher C)

# Set C standard
set(CMAKE_C_STANDARD 99)
set(CMAKE_C_STANDARD_REQUIRED ON)

# Add compiler flags
set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wall -Wextra -O2")

# For Android builds
if(ANDROID)
    set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -DANDROID")
endif()

# Find required libraries
find_package(OpenSSL REQUIRED)
find_package(ZLIB REQUIRED)

# Source file (generated by pack.sh in ../release/)
set(LAUNCHER_SOURCE "${CMAKE_CURRENT_SOURCE_DIR}/../release/launcher.c")

# Check if launcher.c exists
if(NOT EXISTS ${LAUNCHER_SOURCE})
    message(FATAL_ERROR "launcher.c not found. Run pack.sh first to generate it.")
endif()

# Executable
add_executable(dele_launcher ${LAUNCHER_SOURCE})

# Link libraries
target_link_libraries(dele_launcher 
    OpenSSL::Crypto
    ZLIB::ZLIB
)

# For Android, also link log library
if(ANDROID)
    target_link_libraries(dele_launcher log)
endif()

# Install target
install(TARGETS dele_launcher DESTINATION bin)

# Print build information
message(STATUS "Building dele_launcher")
message(STATUS "Source: ${LAUNCHER_SOURCE}")
message(STATUS "OpenSSL include: ${OPENSSL_INCLUDE_DIR}")
message(STATUS "Zlib include: ${ZLIB_INCLUDE_DIRS}")
